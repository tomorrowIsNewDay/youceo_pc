<!DOCTYPE html>
<html>
<head>
  <title>有策管理 工作流</title>
  <meta charset="utf-8">
  <!-- <link rel="stylesheet" type="text/css" href="./asset/css/bootstrap.min.css"> -->
  <link rel="stylesheet" type="text/css" href="./asset/css/iconfont.css">  
 <!-- 本页日期选择插件 -->
 <link rel="stylesheet" href="./asset/css/datepicker3.css">
 <link rel="stylesheet" href="./asset/css/jquery.timepicker.min.css">
  <!-- 本页 dialog 插件 -->
  <link href="./asset/css/jBox.min.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="./asset/css/main.css">
</head>
<body>
<div class="wrapper">
	<header>
		<div class="logo pull-left">
			<a href=""><img src="./asset/images/youceo.png"></a>
		</div>
		<nav class="leftNav pull-left">
			<ul>
				<li><a href="drive.html">推动</a></li>
				<li><a href="taskList.html">任务</a></li>
				<!-- <li><a href="">项目</a></li> -->
				<li><a href="jobAccount.html">工作统计</a></li>
				<li><a href="jobAnalysis.html">工作分析</a></li>
				<li><a href="reportForms.html">报表</a></li>
				<li><a href="crm.html">CRM</a></li>
			</ul>	
		</nav>
		<nav class="rightNav pull-right">
			<ul>
				<li><a href="javascript:;" id="add-a"><i class="icon iconfont icon-plus-circle headericon"></i></a>
					<ul class="avatar-menu">
						<li><a href="addTask.html"><i class="icon iconfont icon-plus-circle"></i>新增任务</a></li>
						<li><a href="" id="newCustomers-a"><i class="icon iconfont icon-add_people"></i>新增客户</a></li>
					</ul>
				</li>
				<li><a href=""><i class="icon iconfont icon-chat headericon"></i></a></li>
				<li>
					<a href="javascript:;" id="avatar-a"><img  class="avatar avatar-34" src="http://www.qq745.com/uploads/allimg/141225/1-141225164J5.jpg"></a>
					<ul class="avatar-menu">
						<li><a href="userinfo.html"><i class="iconfont icon-personal-data"></i>个人资料</a></li>
						<li><a href="cloudDisk.html"><i class="iconfont icon-cloud-disk"></i>云盘</a></li>
						<li><a href="" id="meeting-a"><i class="iconfont icon-meeting"></i>会议模式</a></li>
						<li><a href="workflow.html"><i class="icon iconfont icon-workflow"></i>工作流管理</a></li>
						<li><a href="org.html"><i class="iconfont icon-mail-list"></i>组织架构</a></li>
						<li><a href=""><i class="iconfont icon-Enterprise_information"></i>权限设置</a></li>
						<li><a href=""><i class="iconfont icon-exit"></i>退出</a></li>
					</ul>
				</li>
			</ul>		
		</nav>
	</header>
	<div class="wrapperLeft r0">
		<div class="org">
			<div class="workflowBox">
				<div class="workflowBox-title">
					<h4>工作流管理</h4>
					<button class="btn-g pull-right" style="margin-top: -22px" id="newWorkflow-a">新建工作流</button>
				</div>
				<div class="workflowList">
					<!-- <div class="workflowItem">
						<h5>评审工作流<span class="pull-right"><i class="icon iconfont icon-write"></i><i class="icon iconfont icon-delete"></i></span></h5>
						<ol class="">
							<li><span class="startOrEnd bg-start">流程发起</span><i class="icon iconfont icon-triangle-right"></i></li>
							<li><a href=""><span class="workFlow-span">评审工作流<i class="icon iconfont icon-close"></i></span></a><i class="icon iconfont icon-triangle-right"></i></li>
							<li>
								<span class="avatar relative"><i class="icon iconfont icon-plus-circle"></i></span>
								<div class="dropdownMenu" style="margin:-30px 0 0 30px">
						            		<div class="dropdownMenu-search">
						            			<input type="text" placeholder="输入员工名称">
						            			<i class="icon iconfont icon-search"></i>
						            		</div>
						            		<div class="dropdownMenu-main">
						            			<ul class="dropdownMenu-workFlow ">
							            			<li class="c-text f12">最常添加的同事</li>
							            			<li><a href="">用户体验设计师</a></li>
							            			<li><a href="">设计总监</a></li>
							            			<li><a href="">动效设计师</a></li>
							            		</ul>	
						            		</div>	
						            	</div>
							</li>
							<li class="pull-right"><button class="btn-g">完成</button></li>
						</ol>
					</div> -->
				</div>
			</div>
		</div>
	</div>

</div>
<!-- 头部弹窗 页面通用-->
<div id="newCustomers">
	<form class="staffForm">
		<div>
			<label for="" class="dis-2">公司名称</label><input type="text" placeholder="请输入公司名称" class="dis-8">
		</div>
		<div>
			<label for="" class="dis-2">公司地址</label><input type="text" placeholder="请输入公司地址" class="dis-8">
		</div>
		<div>
			<label for="" class="dis-2">联系人</label><input type="text" placeholder="请输入联系人姓名" class="dis-8">
		</div>
		<div>
			<label for="" class="dis-2">联系方式</label><input type="text" placeholder="请输入联系人联系方式" class="dis-8">
		</div>
		<div>
			<label for="" class="dis-2">邮箱</label><input type="text" placeholder="请输入联系人邮箱" class="dis-8">
		</div>
		<div>
			<label for="" class="dis-2">备注</label><textarea class="dis-8" rows="5" placeholder="备注"></textarea>
		</div>
	</form>
	<div class="jBoxfooter">
		<button class="closejBox">取消</button>
		<button>完成</button>
	</div>
</div>
<!-- 会议弹窗 页面通用-->
<div id="meeting">
	<div class="meeting-title">
		<a href="javascript:;" data-id="appointment" class="active">预约</a>
		<a href="javascript:;" data-id="appointmented">已预约 <span class="meeting-num">2</span></a>
	</div>
	<div>
		<div id="appointment">
			<form class="staffForm">
				<div>
					<label for="" class="dis-2">会议主题</label><input type="text" placeholder="" class="dis-8">
				</div>
				<div>
					<label for="" class="dis-2">会议时间</label><input type="text" name="datepicker" placeholder="选择日期"><input type="text" placeholder="选择时间" name="timepicker">
				</div>
				<div>
					<label for="" class="dis-2">会议地点</label><input type="text" placeholder="" class="dis-8">
				</div>
				<div>
					<span class="dis-2">参会人员</span><div class="dis-8">
						<i class="icon iconfont icon-plus-circle"></i>
						<div class="dropdownMenu">
				            		<div class="dropdownMenu-search">
				            			<input type="text" placeholder="输入员工名称">
				            			<i class="icon iconfont icon-search"></i>
				            		</div>
				            		<div class="dropdownMenu-main">
				            			<ul class="dropdownMenu-addStaff">
					            			<li><a href=""><img class="avatar" src="http://up.qqjia.com/z/25/tu32695_9.jpg">韩一</a></li>
					            			<li><a href=""><img class="avatar" src="http://www.qq745.com/uploads/allimg/141225/1-141225164J5.jpg">章三</a></li>
					            			<li><a href=""><img class="avatar" src="http://www.qq745.com/uploads/allimg/141225/1-141225164J5.jpg">李四</a></li>
					            		</ul>	
				            		</div>	
				            	</div>
					</div>
				</div>
			</form>
			<div class="jBoxfooter">
				<button>预约</button>
				<button>立即开始</button>
				<p>预约后会通知所有参会人员</p>
			</div>

		</div>
		<div id="appointmented">
			<div class="appointmented-item">
				<h4><span>生产部例会</span><span class="pull-right"><s>孙灵光</s> 预约<mark>会议中</mark></span></h4>
				<p>时间：<s>2016-12-22</s><s>08:00</s></p>
				<p>地点：<s>3幢203会议室</s></p>
			</div>
			<div class="appointmented-item">
				<h4><span>生产部例会</span><span class="pull-right"><s>孙灵光</s> 预约</span></h4>
				<p class="pull-right">
					<button>修改</button>
					<button>开始</button>
				</p>
				<p>时间：<s>2016-12-22</s><s>08:00</s></p>
				<p>地点：<s>3幢203会议室</s></p>
			</div>
		</div>
	</div>	
</div>
<div id="delWorkflow">
	<h3>确定删除该工作流?</h3>
	<div class="jBoxfooter tr">
		<button class="closejBox">取消</button>
		<button>确定删除</button>
	</div>
</div>
<div id="newWorkflow">
	<form>
		<div>
			<label for="" class="dis-2 c-text">名称</label><input type="text" name="" class="dis-8 jBoxinput">
		</div>
	</form>
	<div class="jBoxfooter">
		<button class="closejBox">取消</button>
		<button>完成</button>
	</div>
</div>
<!-- <script src="./asset/js/bootstrap.min.js"></script> -->
<script src="./asset/js/jquery-2.2.3.min.js"></script>
<script src="./asset/js/jquery.slimscroll.min.js"></script>
<script src="./asset/js/jBox.min.js"></script>
<!-- 本页日期选择插件 -->
<script src="./asset/js/bootstrap-datepicker.js"></script>
<script src="./asset/js/jquery.timepicker.min.js"></script>
<script src="./asset/js/global.js"></script>
<script type="text/javascript">
$(function(){
	var delWorkflow = new jBox('Modal', {
	  animation: 'pulse',
	  title: '',
	  content: $('#delWorkflow'),
	  preventDefault:true
	});
	var newWorkflow = new jBox('Modal', {
	  attach: '#newWorkflow-a',
	  width:'400px',
	  animation: 'pulse',
	  title: '工作流名称',
	  content: $('#newWorkflow')
	});
	// jBox 取消按钮
	$('.closejBox').on('click',function(){
		delWorkflow.close();
		newWorkflow.close();
	})
	// 新建工作流
	$(document).on('click','#newWorkflow .jBoxfooter>button:last-child',function(){
		var _val = $(this).parent('.jBoxfooter').prev('form').find('input').val();
		$(this).parent('.jBoxfooter').prev('form').find('input').val('')
		if(_val){
			newWorkflow.close()
			var _newWorkflow = '<div class="workflowItem">' + 
							'<h5>'+_val+'</h5>' +
							'<ol>' +
								'<li><span class="startOrEnd bg-start">流程发起</span><i class="icon iconfont icon-triangle-right"></i></li>' +
								'<li>'+
									'<span class="avatar relative"><i class="icon iconfont icon-plus-circle"></i></span>' +
									'<div class="dropdownMenu">' +
							            		'<div class="dropdownMenu-search">'+
							            			'<input type="text" placeholder="输入员工名称">' +
							            			'<i class="icon iconfont icon-search"></i>' +
							            		'</div>'+
							            		'<div class="dropdownMenu-main">' +
							            			'<ul class="dropdownMenu-workFlow ">' +
							            				//此处应为 数据库中获取 员工列表
								            			'<li class="c-text f12">最常添加的同事</li>' +
								            			'<li><a href="">用户体验设计师</a></li>'+
								            			'<li><a href="">设计总监</a></li>'+
								            			'<li><a href="">动效设计师</a></li>'+
								            		'</ul>'+
							            		'</div>'+	
							            	'</div>'+
								'</li>'+
								'<li class="pull-right"><button class="btn-g">完成</button></li>'+
							'</ol>'+
						'</div>'
			$('.workflowList').prepend(_newWorkflow)
		}
	})
	// 修改 工作流
	$(document).on('click',".workflowItem .workFlow-span>.icon-close",function(){
		var thisli = $(this).parents('li');
		var replaceli = $(this).parents('ol').children('li').eq(-2);
		$(thisli).nextUntil(replaceli).remove()//删除区间 li元素
		$(thisli).replaceWith(replaceli)//替换li元素
		return false
	})
	// 编辑 工作流
	$(document).on('click','.workflowItem>h5 .icon-write',function(){
		var newli ='<li>'+
					'<span class="avatar relative"><i class="icon iconfont icon-plus-circle"></i></span>' +
					'<div class="dropdownMenu">' +
			            		'<div class="dropdownMenu-search">'+
			            			'<input type="text" placeholder="输入员工名称">' +
			            			'<i class="icon iconfont icon-search"></i>' +
			            		'</div>'+
			            		'<div class="dropdownMenu-main">' +
			            			'<ul class="dropdownMenu-workFlow ">' +
			            				//此处应为 数据库中获取 员工列表
				            			'<li class="c-text f12">最常添加的同事</li>' +
				            			'<li><a href="">用户体验设计师</a></li>'+
				            			'<li><a href="">设计总监</a></li>'+
				            			'<li><a href="">动效设计师</a></li>'+
				            		'</ul>'+
			            		'</div>'+	
			            	'</div>'+
				'</li>'+
				'<li class="pull-right"><button class="btn-g">完成</button></li>'
		var $arrli = $(this).parents('.workflowItem').children('ol').children('li');
		$arrli.last().replaceWith(newli)
		$arrli.find('.workFlow-span').children('.icon-close').show()

	})
	//删除 工作流
	$(document).on('click','.workflowItem>h5 .icon-delete',function(){
		var parents = $(this).parents('.workflowItem');
		delWorkflow.open()
		$(document).on('click','#delWorkflow .jBoxfooter>button:last-child',function(){
			$(parents).remove();
			delWorkflow.close()
		})
	})
	
	//完成按钮
	$(document).on('click','.workflowItem>ol>li.pull-right>button',function(){
		var endli = '<li><span class="startOrEnd bg-end">结束</span></li>'
		var icon ='<span class="pull-right"><i class="icon iconfont icon-write"></i><i class="icon iconfont icon-delete"></i></span>';
		var h5 =$(this).parents('.workflowItem').children('h5');
		
		if($(h5).children('span').length == 0){
			
			$(h5).append(icon)
		}
		$(this).parents('.workflowItem').find('.icon-close').hide()
		$(this).parent('li').prev().replaceWith(endli)
		$(this).parent('li').remove()
	})
	// 工作流 添加员工
	$(document).on('click','.workflowItem .dropdownMenu-workFlow>li>a',function(){
		var thisval = $(this).text();
		var parentsLi = $(this).parents('.dropdownMenu').parent('li');
		var newli = '<li><a href=""><span class="workFlow-span">'+thisval+
			'<i class="icon iconfont icon-close"></i>'+
			'</span></a><i class="icon iconfont icon-triangle-right"></i></li>'

		$(parentsLi).before(newli)
		// console.log(this)

		return false

	})

})
</script>
</body>
</html>
