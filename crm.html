<!DOCTYPE html>
<html>
<head>
  <title>有策管理 CRM</title>
  <meta charset="utf-8">
  <link rel="stylesheet" href="http://7xkf8c.com2.z0.glb.qiniucdn.com/css/font-awesome.min.css">
  <link rel="stylesheet" type="text/css" href="./asset/css/iconfont.css">
  <!-- 本页日期选择插件 -->
 <link rel="stylesheet" href="./asset/css/datepicker3.css">
 <link rel="stylesheet" href="./asset/css/jquery.timepicker.min.css">
  <!-- 本页 dialog 插件 -->
  <link href="./asset/css/jBox.min.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="./asset/css/main.css">
</head>
<body>
<div class="wrapper">
	<header>
		<div class="logo pull-left">
			<a href=""><img src="./asset/images/youceo.png"></a>
		</div>
		<nav class="leftNav pull-left">
			<ul>
				<li><a href="drive.html">推动</a></li>
				<li><a href="taskList.html">任务</a></li>
				<li><a href="crm.html" class="active">CRM</a></li>
				<li><a href="reportForms.html">报表</a></li>
				<!-- <li><a href="">项目</a></li> -->
				<li><a href="jobAccount.html">工作统计</a></li>
				<li><a href="jobAnalysis.html">工作分析</a></li>
				
			</ul>	
		</nav>
		<nav class="rightNav pull-right">
			<ul>
				<li><a href="javascript:;" id="add-a"><i class="icon iconfont icon-plus-circle headericon"></i></a>
					<ul class="avatar-menu">
						<li><a href="addTask.html"><i class="icon iconfont icon-plus-circle"></i>新增任务</a></li>
						<li><a href="" id="newCustomers-a"><i class="icon iconfont icon-add_people"></i>新增客户</a></li>
					</ul>
				</li>
				<li><a href=""><i class="icon iconfont icon-chat headericon"></i></a></li>
				<li>
					<a href="javascript:;" id="avatar-a"><img  class="avatar avatar-34" src="http://www.qq745.com/uploads/allimg/141225/1-141225164J5.jpg"></a>
					<ul class="avatar-menu">
						<li><a href="userinfo.html"><i class="iconfont icon-personal-data"></i>个人资料</a></li>
						<li><a href="cloudDisk.html"><i class="iconfont icon-cloud-disk"></i>云盘</a></li>
						<li><a href="" id="meeting-a"><i class="iconfont icon-meeting"></i>会议模式</a></li>
						<li><a href="workflow.html"><i class="icon iconfont icon-workflow"></i>工作流管理</a></li>
						<li><a href="org.html"><i class="iconfont icon-mail-list"></i>组织架构</a></li>
						<li><a href=""><i class="iconfont icon-Enterprise_information"></i>权限设置</a></li>
						<li><a href=""><i class="iconfont icon-exit"></i>退出</a></li>
					</ul>
				</li>
			</ul>		
		</nav>
	</header>
	<div class="wrapperLeft">
		<table width="100%" class="task-table grayTable">
			<thead>
				<tr>
					<td width="" class="pl30">公司名称</td>
					<td width="" class="pl20"><div>公司地址</div></td>
					<td width="" class="">业务员<i class="iconfont icon-ascending" style="line-height: 1.4;color: rgb(41,149,231)"></i></td>
				            <td width="">客户等级</td>
				</tr>
			</thead>
			<tbody id=''>
				<tr class="task-tr">
				            <td class="pl30"><img src="http://www.qq745.com/uploads/allimg/141225/1-141225164J5.jpg" class="avatar itype avatar-34">有策管理科技有限公司</td>
				            <td class="pl20">杭州市下沙17号大街2号</td>
					<td class=""><img src="http://www.qq745.com/uploads/allimg/141225/1-141225164J5.jpg" class="avatar itype">我</td>
				            <td>A</td>
				</tr>
				<tr class="task-tr">
				            <td class="pl30"><img src="http://www.qq745.com/uploads/allimg/141225/1-141225164J5.jpg" class="avatar itype avatar-34">有策管理科技有限公司</td>
					<td class="pl20">杭州市下沙17号大街2号</td>
					<td class=""><img src="http://www.qq745.com/uploads/allimg/141225/1-141225164J5.jpg" class="avatar itype">旺仔</td>
				            <td>A</td>
				</tr>
			</tbody>
		</table>	
	</div>
	<div class="wrapperRight">
		<div class="wrapperRight-tittle">
			<ul>
				<li><a href="#detail"  class="active">公司信息</a></li>
				<li><a href="#jobRecord">工作记录</a></li>
				<li><a href="#attachment">合同附件</a></li>
			</ul>
		</div>
		<div class="wrapperRight-main">
			<div style="width: 9999px;height: 100%">
				<!-- 公司信息 -->
				<div id="detail">
					<div class="crmFirminfo pt10" >
						<h4 class="ov-h">
							<span class="pull-right"><button class="btn-g" id="editFirminfo-btn">编辑</button></span>
						</h4>
						<h4 class="crmFirminfoImg">
							<img src="http://www.qq745.com/uploads/allimg/141225/1-141225164J5.jpg" class="avatar  avatar-80">
							<p class="f14">有策管理科技有限公司</p>
						</h4>
						<div><h6 class="dis-3">地址</h6><p class="dis-7">杭州市下沙17号大街2号</p></div>
						<div><h6 class="dis-3">客户等级</h6><p class="dis-7">A</p></div>
						<div><h6 class="dis-3">联系人</h6>
							<div class="crmFirminfoLink">	
								<p data-id="1"><s>张斌</s><span class="pull-right"><s>15068725443</s><i class="icon iconfont icon-delete"></i></span></p>
								<p data-id="2"><s>王斌</s><span class="pull-right"><s>15068725443</s><i class="icon iconfont icon-delete"></i></span></p>
								<p data-id="3"><s>成斌</s><span class="pull-right"><s>15068725443</s><i class="icon iconfont icon-delete"></i></span></p>
								<p id="newContact-p"><i class="icon iconfont icon-plus-circle itype"></i>新增联系人</p>
							</div>
						</div>
						<div><h6 class="dis-3">备注</h6>
							<p class="f14">公司简介公司简介公司简介公司简介公司简介公司简介公司简介公司简介公司简介</p>
						</div>

						
					</div>
				</div>
				<!-- 工作记录 -->
				<div id="jobRecord">
					<ul>
						<li>
							<h5 class="">申请110型产品优惠政策</h5>
							<p class="">2016-12-12<span class="pull-right c-ongoing">进行中</span></p>
						</li>
						<li>
							<h5 class="">申请110型产品优惠政策</h5>
							<p class="">2016-12-12<span class="pull-right c-ongoing">进行中</span></p>
						</li>
						<li>
							<h5 class="">申请110型产品优惠政策</h5>
							<p class="">2016-12-12<span class="pull-right c-completed">已完成</span></p>
						</li>
						<li>
							<h5 class="">申请110型产品优惠政策</h5>
							<p class="">2016-12-12<span class="pull-right c-ongoing">进行中</span></p>
						</li>
						<li>
							<h5 class="">申请110型产品优惠政策</h5>
							<p class="">2016-12-12<span class="pull-right c-ongoing">进行中</span></p>
						</li>
						<li>
							<h5 class="">申请110型产品优惠政策</h5>
							<p class="">2016-12-12<span class="pull-right c-completed">已完成</span></p>
						</li>
						<li>
							<h5 class="">申请110型产品优惠政策</h5>
							<p class="">2016-12-12<span class="pull-right c-ongoing">进行中</span></p>
						</li>
						<li>
							<h5 class="">申请110型产品优惠政策</h5>
							<p class="">2016-12-12<span class="pull-right c-ongoing">进行中</span></p>
						</li>
						<li>
							<h5 class="">申请110型产品优惠政策</h5>
							<p class="">2016-12-12<span class="pull-right c-completed">已完成</span></p>
						</li>
						<li>
							<h5 class="">申请110型产品优惠政策</h5>
							<p class="">2016-12-12<span class="pull-right c-ongoing">进行中</span></p>
						</li>
						<li>
							<h5 class="">申请110型产品优惠政策</h5>
							<p class="">2016-12-12<span class="pull-right c-ongoing">进行中</span></p>
						</li>
						<li>
							<h5 class="">申请110型产品优惠政策</h5>
							<p class="">2016-12-12<span class="pull-right c-completed">已完成</span></p>
						</li>
					</ul>
				</div>
				<!-- 合同附件 -->
				<div id="attachment">
					<div>
			            		<div class="attachment-btn tc">
			            			<label for="fileA" ><i class="icon iconfont icon-fujian"></i>上传附件</label>
							<form><input type="file" id="fileA" ></form>
			            		</div>
			            		<div class="attachment-main">
			            			<ul class="">
				            			<li><a href=""><i class="icon iconfont icon-word itype"></i>2016-12-01.doc</a><span class="pull-right"><img src="http://www.qq745.com/uploads/allimg/141225/1-141225164J5.jpg" class="iconType itype"><i class="icon iconfont icon-download itype"></i><i class="icon iconfont icon-close itype"></i></span></li>
				            			<li><a href=""><i class="icon iconfont icon-word itype"></i>2016-12-02.doc</a><span class="pull-right"><img src="http://www.qq745.com/uploads/allimg/141225/1-141225164J5.jpg" class="iconType itype"><i class="icon iconfont icon-download itype"></i><i class="icon iconfont icon-close itype"></i></span></li>
				            		</ul>	
			            		</div>	
			            	</div>
				</div>
			</div>
		</div>
		<div class="wrapperRight-footer">
			<a href="addTask.html" class="crm-footer"><i class="icon iconfont icon-plus-circle itype"></i>新建任务</a>
		</div>
		<div class="overlay"><i class="iconfont icon-refresh"></i></div>
	</div>

</div>
<!-- 头部弹窗 页面通用-->
<div id="newCustomers">
	<form class="staffForm">
		<div>
			<label for="" class="dis-2">公司名称</label><input type="text" placeholder="请输入公司名称" class="dis-8">
		</div>
		<div>
			<label for="" class="dis-2">公司地址</label><input type="text" placeholder="请输入公司地址" class="dis-8">
		</div>
		<div>
			<label for="" class="dis-2">联系人</label><input type="text" placeholder="请输入联系人姓名" class="dis-8">
		</div>
		<div>
			<label for="" class="dis-2">联系方式</label><input type="text" placeholder="请输入联系人联系方式" class="dis-8">
		</div>
		<div>
			<label for="" class="dis-2">邮箱</label><input type="text" placeholder="请输入联系人邮箱" class="dis-8">
		</div>
		<div>
			<label for="" class="dis-2">备注</label><textarea class="dis-8" rows="5" placeholder="备注"></textarea>
		</div>
	</form>
	<div class="jBoxfooter">
		<button class="closejBox">取消</button>
		<button>完成</button>
	</div>
</div>
<!-- 会议弹窗 页面通用-->
<div id="meeting">
	<div class="meeting-title">
		<a href="javascript:;" data-id="appointment" class="active">预约</a>
		<a href="javascript:;" data-id="appointmented">已预约 <span class="meeting-num">2</span></a>
	</div>
	<div>
		<div id="appointment">
			<form class="staffForm">
				<div>
					<label for="" class="dis-2">会议主题</label><input type="text" placeholder="" class="dis-8">
				</div>
				<div>
					<label for="" class="dis-2">会议时间</label><input type="text" name="datepicker" placeholder="选择日期"><input type="text" placeholder="选择时间" name="timepicker">
				</div>
				<div>
					<label for="" class="dis-2">会议地点</label><input type="text" placeholder="" class="dis-8">
				</div>
				<div>
					<span class="dis-2">参会人员</span><div class="dis-8">
						<i class="icon iconfont icon-plus-circle"></i>
						<div class="dropdownMenu">
				            		<div class="dropdownMenu-search">
				            			<input type="text" placeholder="输入员工名称">
				            			<i class="icon iconfont icon-search"></i>
				            		</div>
				            		<div class="dropdownMenu-main">
				            			<ul class="dropdownMenu-addStaff">
					            			<li><a href=""><img class="avatar" src="http://up.qqjia.com/z/25/tu32695_9.jpg">韩一</a></li>
					            			<li><a href=""><img class="avatar" src="http://www.qq745.com/uploads/allimg/141225/1-141225164J5.jpg">章三</a></li>
					            			<li><a href=""><img class="avatar" src="http://www.qq745.com/uploads/allimg/141225/1-141225164J5.jpg">李四</a></li>
					            		</ul>	
				            		</div>	
				            	</div>
					</div>
				</div>
			</form>
			<div class="jBoxfooter">
				<button>预约</button>
				<button>立即开始</button>
				<p>预约后会通知所有参会人员</p>
			</div>

		</div>
		<div id="appointmented">
			<div class="appointmented-item">
				<h4><span>生产部例会</span><span class="pull-right"><s>孙灵光</s> 预约<mark>会议中</mark></span></h4>
				<p>时间：<s>2016-12-22</s><s>08:00</s></p>
				<p>地点：<s>3幢203会议室</s></p>
			</div>
			<div class="appointmented-item">
				<h4><span>生产部例会</span><span class="pull-right"><s>孙灵光</s> 预约</span></h4>
				<p class="pull-right">
					<button>修改</button>
					<button>开始</button>
				</p>
				<p>时间：<s>2016-12-22</s><s>08:00</s></p>
				<p>地点：<s>3幢203会议室</s></p>
			</div>
		</div>
	</div>	
</div>
<!-- 弹窗	 -->
<div id="editcContact">
	<form class="staffForm">
		<div>
			<label for="name" class="dis-2">姓名</label><input type="text" name="" id="name" class="dis-8">
		</div>
		<div>
			<label for="iphone" class="dis-2">电话</label><input type="text" name="" id="iphone" class="dis-8">
		</div>
		<div>
			<label for="email" class="dis-2">邮箱</label><input type="text" name="" id="email" class="dis-8">
		</div>	
	</form>
	<div class="jBoxfooter">
		<button class="closejBox">取消</button>
		<button>完成</button>
	</div>
</div>
<div id="newContact">
	<form class="staffForm">
		<div>
			<label for="" class="dis-2">姓名</label><input type="text" placeholder="请输入姓名" class="dis-8">
		</div>
		<div>
			<label for="" class="dis-2">电话</label><input type="text" placeholder="请输入电话或手机号码" class="dis-8">
		</div>
		<div>
			<label for="" class="dis-2">邮箱</label><input type="text" placeholder="请输入邮箱地址" class="dis-8">
		</div>	
	</form>
	<div class="jBoxfooter">
		<button class="closejBox">取消</button>
		<button>完成</button>
	</div>
</div>
<div id="editFirminfo">
	<form class="staffForm">
		<div>
			<label for="" class="dis-2">公司名称</label><input type="text" name="" id="" class="dis-8">
		</div>
		<div>
			<label for="" class="dis-2">公司地址</label><input type="text" name="" id="" class="dis-8">
		</div>
		<div>
			<span class="dis-2">客户等级</span><div class="dis-8">
				<select class="input-control">
				  <option>A</option>
				  <option>B</option>
				  <option>C</option>
				</select>
			</div>
		</div>	
		<div>
			<label for="" class="dis-2">备注</label><textarea class="dis-8" rows="5"> </textarea>
		</div>
	</form>
	<div class="jBoxfooter">
		<button class="closejBox">取消</button>
		<button>完成</button>
	</div>
</div>
<div id="delContact">
	<h3>确定删除该联系人？</h3>
	<div class="jBoxfooter tr">
		<button class="closejBox">取消</button>
		<button>确定删除</button>
	</div>
</div>
<!-- <script src="./asset/js/bootstrap.min.js"></script> -->
<script src="./asset/js/jquery-2.2.3.min.js"></script>
<script src="./asset/js/jquery.slimscroll.min.js"></script>
<script src="./asset/js/jBox.min.js"></script>
<!-- 本页日期选择插件 -->
<script src="./asset/js/bootstrap-datepicker.js"></script>
<script src="./asset/js/jquery.timepicker.min.js"></script>
<script src="./asset/js/global.js"></script>
<script type="text/javascript">
$(function(){
	var editFirminfo = new jBox('Modal', {
	  width:'400px',
	  animation: 'pulse',
	  title: '编辑客户信息',
	  content: $('#editFirminfo'),
	  preventDefault:true
	});
	var editcContact = new jBox('Modal', {
	  width:'400px',
	  animation: 'pulse',
	  title: '编辑联系人',
	  content: $('#editcContact'),
	  preventDefault:true
	});
	var newContact = new jBox('Modal', {
	  attach: '#newContact-p',
	  width:'400px',
	  animation: 'pulse',
	  title: '新增联系人',
	  content: $('#newContact'),
	  preventDefault:true
	});
	var delContact = new jBox('Modal', {
	  animation: 'pulse',
	  content: $('#delContact'),
	  preventDefault:true
	});
	// jBox 取消按钮
	$(document).on('click','.closejBox',function(){
		newCustomers.close();
		editFirminfo.close();
		editcContact.close();
		newContact.close();
		delContact.close();
	})
	moreinfo($('tbody .task-tr:first'));//加载第一条信息
	$(document).on('click','tbody .task-tr',function(){
		moreinfo($(this));
	})
	//编辑客户信息
	$(document).on('click','#editFirminfo-btn',function(){
		var _div = $(this).parents('.crmFirminfo').children('div');
		var firmName = $('.crmFirminfoImg').children('p').text()//公司名称
		var address = $(_div).eq(0).children('p').text();//公司地址
		var level = $(_div).eq(1).children('p').text();//客户等级
		var ps = $(_div).eq(-1).children('p').text();//备注
		
		//赋值
		var $div = $('#editFirminfo>.staffForm>div');
		$div.eq(0).children('input').val(firmName);
		$div.eq(1).children('input').val(address);
		$div.eq(2).children('select').val(level);
		$div.eq(3).children('textarea').val(ps);

		editFirminfo.open();

		$('#editFirminfo .jBoxfooter>button:last-child').on('click',function(event){
			var firmName1 = $div.eq(0).children('input').val();
			var address1 = $div.eq(1).children('input').val();
			var level1 = $div.eq(2).find('select').val();
			console.log(level1)
			var ps1 = $div.eq(3).children('textarea').val();
			$('.crmFirminfoImg').children('p').text(firmName1)
			$('.crmFirminfo').children('div').eq(0).children('p').text(address1)
			$('.crmFirminfo').children('div').eq(1).children('p').text(level1);
			$('.crmFirminfo').children('div').eq(-1).children('p').text(ps1);

			editFirminfo.close();
		})
	})
	//查看联系人
	var _id;
	$(document).on('click','.crmFirminfoLink>p:not(:last-child)',function(event){
		var name = $(this).children('s').text();
		var tel = $(this).children('span').children('s').text()
		_id = $($(this).context).data('id');//重点重点
		console.log(_id)
		var $div = $('#editcContact .staffForm>div')
		$div.eq(0).find('input').val(name)
		$div.eq(1).find('input').val(tel)
		editcContact.open()
	})
	// 查看联系人 确定按钮
	$('#editcContact .jBoxfooter>button:last-child').on('click',function(event){
		// console.log(11)
		var btn = event.target;
		var $div =$(btn).parents('.jBoxfooter').prev('form').children('div');
		var name1 = $div.eq(0).find('input').val();
		var tel1 = $div.eq(1).find('input').val()
		var _p = $('.crmFirminfoLink>p:not(:last-child)');

		for(var i = 0;i<_p.length;i++){

			if($(_p[i]).data('id') == _id){

				$(_p[i]).children('s').text(name1);
				$(_p[i]).children('span').children('s').text(tel1)
				editcContact.close()
			}
		}
	})
	
	//删除联系人
	$(document).on('click','.crmFirminfoLink>p .icon-delete',function(event){
		event.stopPropagation();
		var $p = $(this).parents('p');
		delContact.open()
		$('#delContact .jBoxfooter>button:last-child').on('click',function(event){
			$p.remove()
			delContact.close()
		})
	})
	//新增联系人
	$('#newContact .jBoxfooter>button:last-child').on('click',function(event){
			var $div = $(this).parent('.jBoxfooter').prev('form').children('div')
			var name = getNewVal(0,'input',$div)//姓名
			var tel = getNewVal(1,'input',$div)//电话
			var newId = 4;//新增的 ID;应该设置为 动态的
			var newtr ='<p data-id="'+newId+'"><s>'+name+'</s><span class="pull-right"><s>'+tel+'</s><i class="icon iconfont icon-delete"></i></span></p>'

			$('#newContact-p').before(newtr)
			newContact.close()
		})

	//工作记录 滚动条
	$('#jobRecord>ul').slimScroll({
		height:'100%'
	})
	$('.crmFirminfo').slimScroll({
		height:'calc(100% - (10px))'
	})

	function getNewVal(n,el,dom){
    			var val = dom.eq(n).find(el).val();
			dom.eq(n).find(el).val('')
			return val
		}
})
</script>
</body>
</html>
